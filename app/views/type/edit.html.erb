<html>
<head>
<title>Entry: <%= h(@thedef.defhead) %></title>
<script language="javascript" type="text/javascript" src="/javascripts/tiny_mce/tiny_mce.js"></script>
<!-- <script language="javascript" type="text/javascript" src="javascripts/fckeditor/fckeditor.js"></script> -->
<script language="javascript" type="text/javascript">
// TinyMCE stuff
tinyMCE.init({
        mode : "textareas",
        theme : "advanced",
	theme_advanced_buttons1 : "bold,removeformat,separator,undo,redo,separator,charmap,styleselect",
	theme_advanced_buttons2 : "makor,problem,comment",
	theme_advanced_buttons3 : "",
        directionality : "rtl",
        language : 'he_il',
        content_css : "/stylesheets/typing.css",
	setup : function(ed) {
	  // Add our custom buttons
	  ed.addButton('makor', {
		title : '<%= :type_source.l %>',
                image : '/images/source.png',
		onclick : function() {
			ed.focus();
			ed.selection.setContent('<%= :type_source_markup.l %>'+ed.selection.getContent()+'&#93;&#93; ');
		}
	  });
	  ed.addButton('problem', {
		title : '<%= :type_problem.l %>',
                image : '/images/problem.png',
		onclick : function() {
			ed.focus();
			ed.selection.setContent('<%= :type_problem_markup.l %>'+ed.selection.getContent()+'&#93;&#93; ');
		}
	  });
	  ed.addButton('comment', {
		title : '<%= :type_comment.l %>',
                image : '/images/comment.png',
		onclick : function() {
			ed.focus();
			ed.selection.setContent('<%= :type_comment_markup.l %>'+ed.selection.getContent()+'&#93;&#93; ');
			}
		});
	  }
});

// EBYDict stuff

// the following is a bit of generated JS prepared by the typing controller
<%= @parts_js %>

var curpart = 0;
var curfoot = 0;
var curimg = parts[curpart];
var curfootimg = foots[curfoot];
var humanpart;
var humanmaxpart = <%= @partcount %>;
var maxpart = humanmaxpart - 1;
var humanfoot;
var extra_foots = <%= @extra_foots %>;

</script>
</head>
<body>
<%= form_tag '/type/processtype/'+@thedef.id.to_s %>

<!-- main editing area -->
<table>
<tr>
  <td>
    <div align="center"><a href="#" id="but_next" onclick="gonext()"><%= :type_next.l %></a> | <span style="color: green" id="curpos"></span> | <a href="#" id="but_prev" onclick="goprev()"><%= :type_prev.l %></a></div><br/>
    <img id="defpartimg" border="1" src=""/><p/>
    <div align="center"><a href="" id="foot_next" onclick="footnext()"><%= :type_nextfoots.l %></a><a href="#" id="but_next2" onclick="gonext()"><%= :type_next.l %></a> | <span style="color: green" id="curpos2"></span> | <a href="#" id="but_prev2" onclick="goprev()"><%= :type_prev.l %></a> <a href="" id="foot_prev" onclick="footprev()"><%= :type_prevfoots.l %></a></div><br/>
    <a id="defpartlink" href="" target="_new"><%= :type_clicktoenlarge.l %></a>
    <hr/>
    <img id="footimg" border="1" src=""/><p/>

  </td>
  <td><!-- TinyMCE goes here -->
    <div style="position: fixed; top:25px">
<span style="color:green"><%= :type_headword.l %></span><input style="font-family:David;font-size:18pt" dir="rtl" align="right" name="defhead" size="25" value="<%= h(@thedef.defhead) %>"/><br/>
    
      <table><tr><td><textarea id="deftext" name="deftext" rows="10" cols="30"><%= h(@thedef.deftext) %></textarea></td><td> &nbsp;&nbsp; <%= :type_text.l %></td></tr></table>
      <hr/>
      <hr id="helper_hr" style="display: none"/>
      <table><tr><td><textarea id="footnotes" name="footnotes" rows="8" cols="30"><%= h(@thedef.footnotes) %></textarea></td><td> &nbsp;&nbsp; <%= :type_footnotes.l %></td></tr></table>
      <table>
	<tr><th><%= :type_arabic.l %></th><th><%= :type_greek.l %></th><th><%= :type_russian.l %></th><th><%= :type_extra.l %></th></tr>
        <tr>
          <%= @selects %>
        </tr>
      </table><table>
        <tr><td><%= submit_tag :type_saveanddone.l_with_args(:action => @action), :name => 'save_and_done' %></td><td><%= submit_tag :type_save.l, :name => 'commit' %></td></tr><tr><td><%= submit_tag :type_abandon.l, :name => 'abandon' %></td><td><%= submit_tag :type_problem.l, :name => 'problem' %></td> </tr>
      </table>
    </div>
    
  </td>
</tr>
</table>
<input type="hidden" name="act" value="<%= @actno  %>"/>
</form>

<br/>
</body>
<script language="javascript" type="text/javascript">
function chimg(delta) {
  curpart += delta;
  curfoot += delta;
  if(curpart > maxpart)
    curpart = maxpart;
  if(curpart < 0)
    curpart = 0;
  curimg = parts[curpart];
  curfootimg = foots[curfoot];
  humanpart = curpart + 1;
  $('curpos').innerHTML = humanpart+"/"+humanmaxpart
  $('curpos2').innerHTML = humanpart+"/"+humanmaxpart

  $('defpartlink').writeAttribute('href', curimg);
  $('defpartimg').writeAttribute('src', curimg);
  $('footimg').writeAttribute('src', curfootimg);
  $('foot_prev').hide();
  if(curpart == 0) {
    $('but_prev').hide();
    $('but_prev2').hide();
  }
  else {
    $('but_prev').show();
    $('but_prev2').show();
  }
  if(curpart == maxpart) {
    $('but_next').hide();
    $('but_next2').hide();
    if(extra_foots > 0)
      $('foot_next').show();
  }
  else {
   $('foot_next').hide();
   $('but_next').show();
   $('but_next2').show();
  }
}

function chfoot(delta) {
  curfoot += delta;
  if(curfoot == maxpart) {
    $('foot_prev').hide();
    chimg(0); // we're back where def parts are available, so delegate
  }
  else { // we are beyond the def parts
   if(curfoot == maxpart + extra_foots) {
     $('foot_next').hide();
   }
   $('foot_prev').show();
   $('but_prev').hide();
   $('but_prev2').hide();
   curfootimg = foots[curfoot]; 
   $('footimg').writeAttribute('src', curfootimg);
  }
  // TODO: figure out why at the end of this func, the view resets to page 1!
}

function onload() {
  chimg(0);
}

function gonext(e) {
  chimg(1);
}
function goprev(e) {
  chimg(-1);
}

function footnext(e) {
  chfoot(1);
}
function footprev(e) {
  chfoot(-1);
}


</script>

</html>




